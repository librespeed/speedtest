<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no, user-scalable=no" />
    <title>LibreSpeed - Speed Test</title>
    <link rel="shortcut icon" href="favicon.ico">
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;700;900&display=swap" rel="stylesheet">
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script type="text/javascript" src="speedtest.js"></script>

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: white;
        }
        .glass-panel {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
        }
        /* Hide the default messy elements if needed */
        #shareArea { display:none; }
        
        /* Custom Button Animation */
        .pulse-btn {
            box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.7);
            transform: scale(1);
            animation: pulse-green 2s infinite;
        }
        @keyframes pulse-green {
            0% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.7); }
            70% { transform: scale(1); box-shadow: 0 0 0 20px rgba(16, 185, 129, 0); }
            100% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(16, 185, 129, 0); }
        }
    </style>

    <script type="text/javascript">
        // --- KEEPING YOUR ORIGINAL LOGIC INTACT ---
        function I(i){return document.getElementById(i);}
        var SPEEDTEST_SERVERS=[]; 

        var s=new Speedtest(); 
        s.setParameter("telemetry_level","basic"); 

        function initServers(){
            if(SPEEDTEST_SERVERS.length==0){ 
                I("loading").className="hidden";
                I("testWrapper").className="block"; // Changed from visible to block for Tailwind
                initUI();
            } else {
                // (Server selection logic kept simple for this demo)
                s.addTestPoints(SPEEDTEST_SERVERS);
                I("loading").className="hidden";
                I("testWrapper").className="block";
                initUI();
            }
        }

        // Configuration for the gauges
        var meterBk="#334155"; // Dark Slate
        var dlColor="#3b82f6"; // Blue
        var ulColor="#10b981"; // Emerald Green
        var progColor="#475569";

        // Drawing Logic (Standard LibreSpeed)
        function drawMeter(c,amount,bk,fg,progress,prog){
            var ctx=c.getContext("2d");
            var dp=window.devicePixelRatio||1;
            var cw=c.clientWidth*dp, ch=c.clientHeight*dp;
            var sizScale=ch*0.0055;
            if(c.width==cw&&c.height==ch){
                ctx.clearRect(0,0,cw,ch);
            }else{
                c.width=cw;
                c.height=ch;
            }
            ctx.beginPath();
            ctx.strokeStyle=bk;
            ctx.lineWidth=12*sizScale;
            ctx.arc(c.width/2,c.height-58*sizScale,c.height/1.8-ctx.lineWidth,-Math.PI*1.1,Math.PI*0.1);
            ctx.stroke();
            ctx.beginPath();
            ctx.strokeStyle=fg;
            ctx.lineWidth=12*sizScale;
            ctx.arc(c.width/2,c.height-58*sizScale,c.height/1.8-ctx.lineWidth,-Math.PI*1.1,amount*Math.PI*1.2-Math.PI*1.1);
            ctx.stroke();
        }
        
        function mbpsToAmount(s){
            return 1-(1/(Math.pow(1.3,Math.sqrt(s))));
        }
        function format(d){
            d=Number(d);
            if(d<10) return d.toFixed(2);
            if(d<100) return d.toFixed(1);
            return d.toFixed(0);
        }

        var uiData=null;
        function startStop(){
            if(s.getState()==3){
                // Abort
                s.abort();
                data=null;
                I("startStopBtn").textContent="START TEST";
                I("startStopBtn").className="w-48 h-16 bg-blue-600 hover:bg-blue-500 rounded-full text-xl font-bold transition-all shadow-lg cursor-pointer flex items-center justify-center";
                initUI();
            }else{
                // Start
                I("startStopBtn").textContent="RUNNING...";
                I("startStopBtn").className="w-48 h-16 bg-red-600 hover:bg-red-500 rounded-full text-xl font-bold transition-all shadow-lg cursor-pointer flex items-center justify-center animate-pulse";
                s.onupdate=function(data){ uiData=data; };
                s.onend=function(aborted){
                    I("startStopBtn").textContent="TEST AGAIN";
                    I("startStopBtn").className="w-48 h-16 bg-blue-600 hover:bg-blue-500 rounded-full text-xl font-bold transition-all shadow-lg cursor-pointer flex items-center justify-center";
                    updateUI(true);
                };
                s.start();
            }
        }

        function updateUI(forced){
            if(!forced&&s.getState()!=3) return;
            if(uiData==null) return;
            var status=uiData.testState;
            
            // Update Text
            I("ip").textContent=uiData.clientIp;
            I("dlText").textContent=(status==1&&uiData.dlStatus==0)?"...":format(uiData.dlStatus);
            I("ulText").textContent=(status==3&&uiData.ulStatus==0)?"...":format(uiData.ulStatus);
            I("pingText").textContent=format(uiData.pingStatus);
            I("jitText").textContent=format(uiData.jitterStatus);

            // Update Gauges
            drawMeter(I("dlMeter"),mbpsToAmount(Number(uiData.dlStatus*(status==1?oscillate():1))),meterBk,dlColor,Number(uiData.dlProgress),progColor);
            drawMeter(I("ulMeter"),mbpsToAmount(Number(uiData.ulStatus*(status==3?oscillate():1))),meterBk,ulColor,Number(uiData.ulProgress),progColor);
        }

        function oscillate(){ return 1+0.02*Math.sin(Date.now()/100); }

        window.requestAnimationFrame=window.requestAnimationFrame||function(callback){setTimeout(callback,1000/60);};
        function frame(){ requestAnimationFrame(frame); updateUI(); }
        frame();

        function initUI(){
            drawMeter(I("dlMeter"),0,meterBk,dlColor,0);
            drawMeter(I("ulMeter"),0,meterBk,ulColor,0);
            I("dlText").textContent="-";
            I("ulText").textContent="-";
            I("pingText").textContent="-";
            I("jitText").textContent="-";
            I("ip").textContent="Checking IP...";
        }
    </script>
</head>
<body onload="initServers()" class="min-h-screen flex items-center justify-center p-4">

    <div id="loading" class="fixed inset-0 bg-slate-900 z-50 flex flex-col items-center justify-center text-white">
        <div class="animate-spin rounded-full h-16 w-16 border-t-2 border-b-2 border-blue-500 mb-4"></div>
        <p>Initializing Speedtest...</p>
    </div>

    <div id="testWrapper" class="hidden w-full max-w-4xl">
        
        <div class="text-center mb-8">
            <h1 class="text-4xl md:text-5xl font-black tracking-tight text-white mb-2">
                Libre <span class="text-blue-500">Speed</span>
            </h1>
            <p class="text-slate-400 text-sm tracking-widest uppercase">High Speed Fiber Internet</p>
        </div>

        <div class="glass-panel rounded-3xl p-8 md:p-10">
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-10">
                <div class="flex flex-col items-center">
                    <p class="text-blue-400 font-bold tracking-wider mb-2">DOWNLOAD</p>
                    <div class="relative w-64 h-32 md:w-80 md:h-40">
                        <canvas id="dlMeter" class="w-full h-full"></canvas>
                        <div class="absolute bottom-0 left-0 w-full text-center">
                            <span id="dlText" class="text-4xl md:text-5xl font-bold text-white">-</span>
                            <span class="text-sm text-slate-400 block">Mbps</span>
                        </div>
                    </div>
                </div>

                <div class="flex flex-col items-center">
                    <p class="text-emerald-400 font-bold tracking-wider mb-2">UPLOAD</p>
                    <div class="relative w-64 h-32 md:w-80 md:h-40">
                        <canvas id="ulMeter" class="w-full h-full"></canvas>
                        <div class="absolute bottom-0 left-0 w-full text-center">
                            <span id="ulText" class="text-4xl md:text-5xl font-bold text-white">-</span>
                            <span class="text-sm text-slate-400 block">Mbps</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-2 gap-4 mb-10 border-t border-slate-700 pt-8">
                <div class="text-center">
                    <p class="text-xs text-slate-400 uppercase tracking-widest mb-1">Ping</p>
                    <p class="text-2xl font-bold text-white"><span id="pingText">-</span> <span class="text-sm font-normal text-slate-500">ms</span></p>
                </div>
                <div class="text-center">
                    <p class="text-xs text-slate-400 uppercase tracking-widest mb-1">Jitter</p>
                    <p class="text-2xl font-bold text-white"><span id="jitText">-</span> <span class="text-sm font-normal text-slate-500">ms</span></p>
                </div>
            </div>

            <div class="flex flex-col items-center justify-center">
                <div id="startStopBtn" onclick="startStop()" class="w-48 h-16 bg-blue-600 hover:bg-blue-500 rounded-full text-xl font-bold transition-all shadow-lg cursor-pointer flex items-center justify-center pulse-btn select-none">
                    START
                </div>
                
                <div class="mt-6 flex items-center gap-2 text-slate-400 text-sm">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9" />
                    </svg>
                    <span id="ip">Detecting IP...</span>
                </div>
            </div>

        </div>
        
        <div class="text-center mt-6 text-slate-500 text-xs">
            Powered by LibreSpeed & LibreSpeed
        </div>
    </div>

</body>
</html>